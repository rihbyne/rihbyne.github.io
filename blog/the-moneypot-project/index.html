<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>    Moneypot Project - the betting app
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href='https://fonts.googleapis.com/css?family=Gentium+Book+Basic|Merriweather:400,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://rihenperry.github.io/theme/css/cid.css">
        <link href="https://rihenperry.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="swlogs Atom Feed" />
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

            <div class="container">

<style rel="text/css">
 body p {
    text-align: justify
 }

 .site-logo {
    float: left;
  }
.container .blog-header h1 , .container .blog-header p {
}
.container .blog-header h1 {

    display: inline-block;
}
.site-logo img {
    width: 100%;
    max-width: 110px;
    height: auto;
margin-right:25px;
}

 .blog-header nav a {
    text-decoration:none;
     color: blue;
 }

 .blog-footer .nav a {
     text-decoration: none;
     color: blue;
 }

 .blog-footer .nav .dots {
     font-weight: bold;
 }
</style>
<header class="blog-header">
  <div class="header-container" style="height: auto">
    <div class="site-logo" >
       <img  src="https://rihenperry.github.io/images/android-chrome-512x512.png">
    </div>
    <div>
      <h1>
       <a href="https://rihenperry.github.io">swlogs</a>
      </h1>
      <p> recording happenings around </p>
    </div>
  </div>
        <nav>
           <a href="https://rihenperry.github.io/blog">INDEX</a>
           <span class="header-dots">.</span>
           <a href="https://rihenperry.github.io/archives">ARCHIVES</a>
           <span class="header-dots">.</span>
           <a href="https://rihenperry.github.io/categories">CATEGORIES</a>
           <span class="header-dots">.</span>
           <a href="https://rihenperry.github.io/tags">TAGS</a>
       </nav>
</header>

    <div class="post">
        <header>
            <h1>Moneypot Project - the betting app</h1>
            <p class="date">
              Posted on Mar 14 2016 22:01 in
              <a href="https://rihenperry.github.io/category/softwaredesign">
                softwaredesign
              </a>

              &#8226; 5 min read
            </p>
        </header>

        <article>
          <div>
            <p><a href="http://moneypot.com/">Moneypot</a> is a bitcoin wallet but not a full fledge hot wallet out there like blockchain’s
“my wallet” or coinbase’s wallet. Money wallet handles bitcoin money for its users. Usually, all the transactions
take place in <strong>bits(1BTC = 106)</strong> or <strong>satoshi(1BTC = 108)</strong>. Besides this, Moneypot  serves as a platform for
application developers who make gambling games to handle the mathematics behinding casino logic, the betting criteria,
user authentication,etc. Before any app can use Moneypot services, that particular app is approved and
authorized  by Moneypot and then the services are made available.Since, Moneypot act as a bitcoin fund
manager.It can be used to receive bitcoins from cold storage using cold addresses or from existing hot
wallet using hot bitcoin addresses.It can also be used to send bitcoins to others using receiver&rsquo;s bitcoin
address. The Apps which use moneypot&rsquo;s API allows its users to get btc&rsquo;s in bits from its moneypot wallet as
well as withdraw deposited funds back into the wallet once done with game playing or betting.This allows
users who play betting games to transfer losable money from moneypot wallet to apps and vice versa.So the
moneypot wallet serves as a sandbox for money transfer between games that use its API.</p>
<h2 id="components-of-moneypot">Components of Moneypot :</h2>
<p><img alt="overview_moneypot" src="https://rihenperry.github.io/blog/the-moneypot-project/image04.png"></p>
<p>A bitcoin wallet implementation requires the use of bitcoin-core. The bitcoin-core, also called as a
full-node is a program that is used to validate transactions and blocks.Since bitcoin doesn’t have a
centralized governing body, anyone who runs a bitcoin-core helps the peer-to-peer network. So if you are
running a full-node you become the volunteer.Your full-node accepts transactions and blocks from other full
nodes, validating those and relaying them to next full nodes.In moneypot’s case, running bitcoin-core is
required because it gives them full control over their node and take special safety precautions. To interact
with bitcoin-core, bitcoind is required. bitcoind is a daemon which runs in the background and talks with
bitcoin-core. The talking takes place in JSON-RPC.There is a seperate CLI utility which is also a RPC client
which connects to bitcoind.So bitcoind serves as a RPC server.In order to programmatically talk with bitcoind
there are languages bindings available. For javascript, this project makes use of bitcoinjs and bitcoinjs-lib.</p>
<p>The <strong>node-pg</strong> is node-postgres db driver used in Moneypot to fire queries to postgresql DB.</p>
<p>The diagram clearly illustrates the five core components of Moneypot:</p>
<ul>
<li>
<p>The <strong>moneypot-api</strong> implements Oauth framework version 2.0. It acts as a Oauth provider for apps like
exampleapp.com as shown in the figure. Any external app which uses moneypot-api gets user authentication
handling, and other resources served via http.</p>
</li>
<li>
<p>The <strong>moneypot-web</strong> is web application which allows users to sign into the wallet and manage funds like receive
and move around its approved apps for betting.Along with this, it gives you meta-data about your money in
wallet.</p>
</li>
<li>
<p>The <strong>moneypot-depositor</strong> talks with bitcoind which in turn talks to full node connected to blockchain
network.</p>
</li>
<li>
<p>The <strong>socketpot</strong> is moneypot’s websocket server and its main purpose is to stream notification and alerts over
the network in real time to the apps which connect to it.</p>
</li>
</ul>
<h2 id="apps-on-moneypot">Apps on Moneypot:</h2>
<p><img alt="apps_moneypot" src="https://rihenperry.github.io/blog/the-moneypot-project/image10.png"></p>
<p>From the above figure,  an exampleBet.com built by its developers uses Moneypot’s API for its services.
exampleBet.com is deployed seperately on different machine but uses moneypot’s services served at
api.moneypot.com. Before any app can use moneypot-api, they need to register the app on moneypot-web.On
registering the app, moneypot-web will generate &lsquo;app_id&rsquo; followed by other params like &lsquo;app_secret&rsquo; which are
required if using confidential flow or access_token is required if using implicit flow. So, the moneypot api
handles the third-party authentication. Now, the application developer can make request on moneypot api from
the browser app or from the server app.Just remember that, every time you make a request to api server you
have to include app_id and (access_token or app_secret) depending on the flow type, not doing so, will get
403 status code. All the endpoints are  located at api-docs.</p>
<h2 id="users-on-moneypot">Users on Moneypot:</h2>
<p><img alt="api_web" src="https://rihenperry.github.io/blog/the-moneypot-project/image08.png"></p>
<p>The diagram illustrates how user uses moneypot-api and moneypot-web.The moneypot-web offers administrative
dashboard UI for its users.User plays any of the approved games(Apps) listed on moneypot.com.Assuming User
is not logged into any app. Before using any app, the user should login into the app he/she wishes to play.
Mosts apps will include the login UI, but, in the background it will call moneypot.com/oauth/authorize?<PARAMS>
to login the user on moneypot’s server instead of their own app server.The javascript app behind the scene will
parse out  the access_token and auth_id which will have a two-weeks expiration timeout. Once logged inside,
user may deposit bits he wishes to gamble from moneypot dashboard to that app and vice versa.Every bet the user
makes,whether its a win or loss, the app developer gets the steady commission, the moneypot gets some percentage
of steady commission. If user losses the bet, the wagered amount is lost and taken by the bankroll. If the user
wins the user wins the betted amount along with the winning odds.</p>
<h2 id="application-architecture">Application Architecture:</h2>
<p><img alt="app_stacks" src="https://rihenperry.github.io/blog/the-moneypot-project/image05.png"></p>
<p>The above three figures provides a top-to-bottom view of how the services in moneypot are layered.One thing you
will notice missing is the socketpot code layout. Thats because I dont have access to socketpot yet.All the three
figures have the “libs” block which is the library block.It contains common javasript modules which are accessed
and used more than once across most of the application.</p>
<h2 id="moneypot-api-app-stack">Moneypot-api App Stack:</h2>
<p>moneypot-api running on NodeJS instance version 5.x. Its ES-6 compatible.Meaning that it supports new js features
like promises, generators,iterators,sync, etc.The koa-middleware block, koa is a web-framework used for building
web apps and API’s.you get koa-core and depending on your need can install middlewares for your application. The
koa compatible middlewares are named like koa-*(eg-&gt; koa-bodyparser, koa-acl, koa-json-parser,etc). It plays well
and inherently supports ES6 features.</p>
<p>The api at request/response level is a object contains an array which hold generator functions which executed in
“U” shaped stack like manner as per the request.The array holds middlewares in use. Koa uses “yield” and “next”
to pass control between the series of functions(middlewares).When any middleware down the “U” shape invokes “yield
next” down the stream, the function suspends its execution and passes the control to the next function. Until
there are no more middlwares down the stream to execute, the request follows back to the initial middleware and
resumes to execute the remaining code from where it got suspending by “yield next”.This way, Moneypot-api uses
many koa-* middlewares in its codebase.Its simple and pluggable.</p>
<p>A short code excerpt from moneypot-api just shows that.</p>
<div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyparser</span><span class="p">({</span>
  <span class="c1">// Treat &#39;Content-Type: text/plain&#39; body as JSON</span>
  <span class="nx">extendTypes</span><span class="o">:</span> <span class="p">{</span> <span class="nx">json</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;text/plain&#39;</span><span class="p">]</span> <span class="p">}</span>
<span class="p">}));</span>

<span class="c1">// x-response-time</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="o">*</span><span class="p">(</span><span class="nx">next</span><span class="p">){</span>
 <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
 <span class="k">yield</span> <span class="nx">next</span><span class="p">;</span>
 <span class="kd">var</span> <span class="nx">ms</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span> <span class="o">-</span> <span class="nx">start</span><span class="p">;</span>
 <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;X-Response-Time&#39;</span><span class="p">,</span> <span class="nx">ms</span> <span class="o">+</span> <span class="s1">&#39;ms&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// logger</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span> <span class="o">*</span><span class="p">(</span><span class="nx">next</span><span class="p">){</span>
 <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
 <span class="k">yield</span> <span class="nx">next</span><span class="p">;</span>
 <span class="kd">var</span> <span class="nx">ms</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span> <span class="o">-</span> <span class="nx">start</span><span class="p">;</span>
 <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;%s %s - %s&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">method</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">ms</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
          </div>
          <div>
            <p>
              Tags -
                    <a href="https://rihenperry.github.io/tag/nodejs">nodejs</a>
                    <a href="https://rihenperry.github.io/tag/postgresql">postgresql</a>
                    <a href="https://rihenperry.github.io/tag/generators">generators</a>
                    <a href="https://rihenperry.github.io/tag/btc">btc</a>
                    <a href="https://rihenperry.github.io/tag/satoshi">satoshi</a>
                    <a href="https://rihenperry.github.io/tag/kelly-criteron">kelly criteron</a>
            </p>
          </div>
        </article>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'swlogs';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            dsq.setAttribute('data-timestamp', +new Date());
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
    </div>


<footer class="blog-footer">

    <ul class="nav">
                    <li><a href="https://rihenperry.github.io/blog">posts</a></li>
                    <li class="dots">.</li>
                    <li><a href="https://rihenperry.github.io/diy">solos</a></li>
                    <li class="dots">.</li>
                    <li><a href="https://rihenperry.github.io/downloadables/resume.pdf">resume</a></li>
                    <li class="dots">.</li>
                    <li><a href="https://rihenperry.github.io/https://goodreads.com/rihanpereira">reading</a></li>
                    <li class="dots">.</li>
    </ul>

    <p class="disclaimer">
        Rihan &copy; 2019. Contents are <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/us/">cc by-nc-sa</a>. All opinions are of my own.
    </p>
</footer>
            </div>
    </body>
</html>